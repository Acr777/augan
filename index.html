<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time User Location Tracking</title>
    <style>
        #map { 
            height: 60vh; /* Set the map height to 60% of the viewport height */
            width: 80%; /* Set the map width to 80% of the viewport width */
            margin: 0 auto; /* Center the map horizontally */
            border: 2px solid #ccc; /* Add a border around the map */
            border-radius: 10px; /* Add border radius */
        }
        #location-info {
            text-align: center; /* Center-align the location info */
            margin-top: 20px; /* Add some space between the map and location info */
        }
        #search-form {
            text-align: center; /* Center-align the search form */
            margin-top: 20px; /* Add some space between the map and search form */
        }
        .search-input {
            padding: 5px; /* Add padding to the search input field */
            border-radius: 5px; /* Add border radius to the search input field */
            border: 1px solid #ccc; /* Add border to the search input field */
            margin-right: 5px; /* Add margin to the right of the search input field */
        }
        #search-button {
            padding: 5px 10px; /* Add padding to the search button */
            border-radius: 5px; /* Add border radius to the search button */
            background-color: #007bff; /* Set background color of the search button */
            color: #fff; /* Set text color of the search button */
            border: none; /* Remove border of the search button */
            cursor: pointer; /* Set cursor style to pointer for the search button */
        }
        #start-button {
            padding: 5px 10px; /* Add padding to the start button */
            border-radius: 5px; /* Add border radius to the start button */
            background-color: #28a745; /* Set background color of the start button */
            color: #fff; /* Set text color of the start button */
            border: none; /* Remove border of the start button */
            cursor: pointer; /* Set cursor style to pointer for the start button */
            margin-top: 10px; /* Add margin to the top of the start button */
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="location-info">
        <p>Source: Latitude: <span id="source-lat"></span>, Longitude: <span id="source-lng"></span>, Place: <span id="source-place"></span></p>
        <p>Destination: Latitude: <span id="dest-lat"></span>, Longitude: <span id="dest-lng"></span>, Place: <span id="dest-place"></span>, Distance: <span id="distance"></span> km</p>
    </div>
    <div id="search-form">
        <input type="text" id="source-input" class="search-input" placeholder="Enter source">
        <input type="text" id="dest-input" class="search-input" placeholder="Enter destination">
        <button id="search-button">Search</button>
        <button id="start-button">Start</button>
    </div>
    <script>
        var map, sourceMarker, destMarker, directionsService, directionsDisplay, watchID;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 12,
                center: {lat: 0, lng: 0}
            });

            sourceMarker = new google.maps.Marker({
                map: map,
                title: 'Source'
            });

            destMarker = new google.maps.Marker({
                map: map,
                title: 'Destination'
            });

            directionsService = new google.maps.DirectionsService;
            directionsDisplay = new google.maps.DirectionsRenderer;
            directionsDisplay.setMap(map);
        }

        function updateMarkerAndCoordinates(marker, lat, lng) {
            var pos = {lat: lat, lng: lng};
            marker.setPosition(pos);
            return {lat: lat.toFixed(6), lng: lng.toFixed(6)};
        }

        function fetchPlace(lat, lng, elementId) {
            var geocoder = new google.maps.Geocoder;
            var latlng = {lat: parseFloat(lat), lng: parseFloat(lng)};
            geocoder.geocode({'location': latlng}, function(results, status) {
                if (status === 'OK') {
                    if (results[0]) {
                        document.getElementById(elementId).textContent = results[0].formatted_address;
                    } else {
                        console.error('No results found');
                    }
                } else {
                    console.error('Geocoder failed due to: ' + status);
                }
            });
        }

        document.getElementById('search-button').addEventListener('click', function() {
            var sourceQuery = document.getElementById('source-input').value.trim();
            var destQuery = document.getElementById('dest-input').value.trim();
            if (sourceQuery !== '' && destQuery !== '') {
                var geocoder = new google.maps.Geocoder;
                geocoder.geocode({'address': sourceQuery}, function(sourceResults, sourceStatus) {
                    if (sourceStatus === 'OK') {
                        var sourceLat = sourceResults[0].geometry.location.lat();
                        var sourceLng = sourceResults[0].geometry.location.lng();
                        var destQuery = document.getElementById('dest-input').value;
                        geocoder.geocode({'address': destQuery}, function(destResults, destStatus) {
                            if (destStatus === 'OK') {
                                var destLat = destResults[0].geometry.location.lat();
                                var destLng = destResults[0].geometry.location.lng();
                                map.setCenter({lat: destLat, lng: destLng});
                                var sourceCoords = updateMarkerAndCoordinates(sourceMarker, sourceLat, sourceLng);
                                fetchPlace(sourceCoords.lat, sourceCoords.lng, 'source-place');
                                document.getElementById('source-lat').textContent = sourceCoords.lat;
                                document.getElementById('source-lng').textContent = sourceCoords.lng;
                                var destCoords = updateMarkerAndCoordinates(destMarker, destLat, destLng);
                                fetchPlace(destCoords.lat, destCoords.lng, 'dest-place');
                                document.getElementById('dest-lat').textContent = destCoords.lat;
                                document.getElementById('dest-lng').textContent = destCoords.lng;

                                calculateAndDisplayRoute(sourceCoords, destCoords);
                            } else {
                                console.error('Geocode was not successful for the following reason: ' + destStatus);
                            }
                        });
                    } else {
                        console.error('Geocode was not successful for the following reason: ' + sourceStatus);
                    }
                });
            }
        });

        document.getElementById('start-button').addEventListener('click', function() {
            if (watchID === undefined) {
                watchID = navigator.geolocation.watchPosition(function(position) {
                    var lat = position.coords.latitude;
                    var lng = position.coords.longitude;
                    var currentCoords = updateMarkerAndCoordinates(sourceMarker, lat, lng);
                    map.setCenter({lat: lat, lng: lng});
                    map.setZoom(15);
                    fetchPlace(lat, lng, 'source-place');
                    document.getElementById('source-lat').textContent = currentCoords.lat;
                    document.getElementById('source-lng').textContent = currentCoords.lng;

                    calculateAndDisplayRoute(currentCoords, destCoords);
                });
            }
        });

        function calculateAndDisplayRoute(sourceCoords, destCoords) {
            directionsService.route({
                origin: sourceCoords,
                destination: destCoords,
                travelMode: 'DRIVING'
            }, function(response, status) {
                if (status === 'OK') {
                    directionsDisplay.setDirections(response);
                    var route = response.routes[0];
                    var distance = 0;
                    for (var i = 0; i < route.legs.length; i++) {
                        distance += route.legs[i].distance.value;
                    }
                    document.getElementById('distance').textContent = (distance / 1000).toFixed(2);
                } else {
                    console.error('Directions request failed due to ' + status);
                }
            });
        }

    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAwjNkVZ0mr30RDn-X84NCq7QbfHvUCxMI&callback=initMap" async defer></script>
</body>
</html>



